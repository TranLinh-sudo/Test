-- Dịch vụ cần thiết
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local LocalPlayer = Players.LocalPlayer

-- Hàm bảo vệ UI
local function getParent()
	local success, result = pcall(function()
		return CoreGui
	end)
	if success then
		return result
	else
		return LocalPlayer:WaitForChild("PlayerGui")
	end
end

-- --- CẤU HÌNH MÀU SẮC ---
local Colors = {
	Background = Color3.fromRGB(20, 20, 20),
	Sidebar = Color3.fromRGB(15, 15, 15),
	ItemBG = Color3.fromRGB(30, 30, 30),
	Text = Color3.fromRGB(255, 255, 255),
	Accent = Color3.fromRGB(255, 215, 0), -- Màu vàng
	Close = Color3.fromRGB(200, 50, 50),
	Green = Color3.fromRGB(50, 200, 50) -- Màu xanh cho tiền
}

-- --- DANH SÁCH TÊN TAB ---
local TabNames = {
	"Trạng thái", "Fam", "Biển", "item", "trái & tập kích", 
	"cửa hàng", "Di chuyển", "Tộc V4", "Núi lửa", 
	"Đảo LEVI", "Đảo cáo", "PVP", "Cài đặt"
}

-- --- TẠO GUI CHÍNH ---
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "BananaCatHub_Status"
ScreenGui.Parent = getParent()
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- ICON TOGGLE
local OpenButton = Instance.new("ImageButton")
OpenButton.Parent = ScreenGui
OpenButton.BackgroundColor3 = Colors.Background
OpenButton.Position = UDim2.new(0.02, 0, 0.15, 0)
OpenButton.Size = UDim2.new(0, 50, 0, 50)
OpenButton.Image = "rbxassetid://13693489228"
OpenButton.Visible = true
Instance.new("UICorner", OpenButton).CornerRadius = UDim.new(1, 0)
Instance.new("UIStroke", OpenButton).Color = Colors.Accent
OpenButton.UIStroke.Thickness = 2

-- MAIN FRAME
local MainFrame = Instance.new("Frame")
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Colors.Background
MainFrame.BackgroundTransparency = 0.1
MainFrame.AnchorPoint = Vector2.new(0.5, 0.5) 
MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
MainFrame.Size = UDim2.new(0.75, 0, 0.75, 0) 
MainFrame.ClipsDescendants = true 
Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 10)

OpenButton.MouseButton1Click:Connect(function() MainFrame.Visible = not MainFrame.Visible end)

-- TOP BAR
local TopBar = Instance.new("Frame")
TopBar.Parent = MainFrame
TopBar.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
TopBar.BackgroundTransparency = 1
TopBar.Size = UDim2.new(1, 0, 0, 40)

local HeaderTitle = Instance.new("TextLabel")
HeaderTitle.Parent = TopBar
HeaderTitle.BackgroundTransparency = 1
HeaderTitle.Position = UDim2.new(0, 15, 0, 0)
HeaderTitle.Size = UDim2.new(0.6, 0, 1, 0)
HeaderTitle.Font = Enum.Font.GothamBold
HeaderTitle.Text = "Banana Cat Hub - Status Update"
HeaderTitle.TextColor3 = Colors.Accent
HeaderTitle.TextSize = 18
HeaderTitle.TextXAlignment = Enum.TextXAlignment.Left

local CloseBtn = Instance.new("TextButton")
CloseBtn.Parent = TopBar
CloseBtn.BackgroundColor3 = Colors.Close
CloseBtn.Position = UDim2.new(1, -35, 0.5, -12)
CloseBtn.Size = UDim2.new(0, 24, 0, 24)
CloseBtn.Text = "X"
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
Instance.new("UICorner", CloseBtn).CornerRadius = UDim.new(0, 6)
CloseBtn.MouseButton1Click:Connect(function() ScreenGui:Destroy() end)

local MinimizeBtn = Instance.new("TextButton")
MinimizeBtn.Parent = TopBar
MinimizeBtn.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
MinimizeBtn.Position = UDim2.new(1, -70, 0.5, -12)
MinimizeBtn.Size = UDim2.new(0, 24, 0, 24)
MinimizeBtn.Text = "-"
MinimizeBtn.Font = Enum.Font.GothamBold
MinimizeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
Instance.new("UICorner", MinimizeBtn).CornerRadius = UDim.new(0, 6)
MinimizeBtn.MouseButton1Click:Connect(function() MainFrame.Visible = false end)

-- LAYOUT
local Sidebar = Instance.new("Frame")
Sidebar.Parent = MainFrame
Sidebar.BackgroundColor3 = Colors.Sidebar
Sidebar.BackgroundTransparency = 0.5
Sidebar.Position = UDim2.new(0, 0, 0, 40)
Sidebar.Size = UDim2.new(0.25, 0, 1, -40)
Sidebar.BorderSizePixel = 0

local TabList = Instance.new("ScrollingFrame")
TabList.Parent = Sidebar
TabList.BackgroundTransparency = 1
TabList.Position = UDim2.new(0, 10, 0, 10)
TabList.Size = UDim2.new(1, -20, 1, -10)
TabList.ScrollBarThickness = 4
TabList.AutomaticCanvasSize = Enum.AutomaticSize.Y
TabList.ScrollingDirection = Enum.ScrollingDirection.Y
Instance.new("UIListLayout", TabList).Padding = UDim.new(0, 10)

local ContentContainer = Instance.new("Frame")
ContentContainer.Parent = MainFrame
ContentContainer.BackgroundTransparency = 1
ContentContainer.Position = UDim2.new(0.25, 10, 0, 50)
ContentContainer.Size = UDim2.new(0.75, -20, 1, -60)

-- --- LOGIC TAB ---
local Pages = {} 
local currentTab = nil

local function CreateTab(name)
	local Page = Instance.new("ScrollingFrame")
	Page.Name = name .. "_Page"
	Page.Parent = ContentContainer
	Page.BackgroundTransparency = 1
	Page.Size = UDim2.new(1, 0, 1, 0)
	Page.ScrollBarThickness = 4
	Page.AutomaticCanvasSize = Enum.AutomaticSize.Y
	Page.Visible = false
	Instance.new("UIListLayout", Page).Padding = UDim.new(0, 8)

	local TabButton = Instance.new("TextButton")
	TabButton.Parent = TabList
	TabButton.BackgroundColor3 = Colors.Background
	TabButton.Size = UDim2.new(1, -10, 0, 40)
	TabButton.Font = Enum.Font.GothamBold
	TabButton.Text = name
	TabButton.TextColor3 = Color3.fromRGB(150, 150, 150)
	TabButton.TextSize = 14
	Instance.new("UICorner", TabButton).CornerRadius = UDim.new(0, 8)
	local Stroke = Instance.new("UIStroke")
	Stroke.Parent = TabButton
	Stroke.Color = Color3.fromRGB(60, 60, 60)
	Stroke.Thickness = 1.5
	Stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border

	TabButton.MouseButton1Click:Connect(function()
		for _, v in pairs(TabList:GetChildren()) do
			if v:IsA("TextButton") then
				v.TextColor3 = Color3.fromRGB(150, 150, 150)
				v.UIStroke.Color = Color3.fromRGB(60, 60, 60)
			end
		end
		for _, v in pairs(ContentContainer:GetChildren()) do v.Visible = false end
		
		TabButton.TextColor3 = Colors.Accent
		Stroke.Color = Colors.Accent
		Page.Visible = true
	end)

	if currentTab == nil then
		currentTab = Page
		Page.Visible = true
		TabButton.TextColor3 = Colors.Accent
		Stroke.Color = Colors.Accent
	end
	Pages[name] = Page
end

for _, name in ipairs(TabNames) do CreateTab(name) end

-- --- HÀM TẠO MỤC HIỂN THỊ TRẠNG THÁI (STATUS LABEL) ---
local function CreateStatusItem(tabName, labelText, getValueFunc)
	local page = Pages[tabName]
	if not page then return end

	local ItemFrame = Instance.new("Frame")
	ItemFrame.Parent = page
	ItemFrame.BackgroundColor3 = Colors.ItemBG
	ItemFrame.BackgroundTransparency = 0.5
	ItemFrame.Size = UDim2.new(1, -10, 0, 40)
	Instance.new("UICorner", ItemFrame).CornerRadius = UDim.new(0, 6)
	
	-- Nhãn (Ví dụ: "Tộc :")
	local Label = Instance.new("TextLabel")
	Label.Parent = ItemFrame
	Label.BackgroundTransparency = 1
	Label.Position = UDim2.new(0, 15, 0, 0)
	Label.Size = UDim2.new(0.4, 0, 1, 0)
	Label.Font = Enum.Font.GothamSemibold
	Label.Text = labelText
	Label.TextColor3 = Colors.Text
	Label.TextSize = 14
	Label.TextXAlignment = Enum.TextXAlignment.Left
	
	-- Giá trị (Ví dụ: "Human")
	local ValueLabel = Instance.new("TextLabel")
	ValueLabel.Parent = ItemFrame
	ValueLabel.BackgroundTransparency = 1
	ValueLabel.Position = UDim2.new(0.4, 0, 0, 0)
	ValueLabel.Size = UDim2.new(0.6, -15, 1, 0)
	ValueLabel.Font = Enum.Font.GothamBold
	ValueLabel.Text = "Loading..."
	ValueLabel.TextColor3 = Colors.Accent -- Màu vàng
	ValueLabel.TextSize = 14
	ValueLabel.TextXAlignment = Enum.TextXAlignment.Right

	-- Cập nhật giá trị liên tục
	spawn(function()
		while ItemFrame.Parent do -- Chỉ chạy khi GUI còn tồn tại
			local success, val = pcall(getValueFunc)
			if success and val then
				ValueLabel.Text = tostring(val)
			else
				ValueLabel.Text = "N/A"
			end
			wait(1) -- Cập nhật mỗi 1 giây
		end
	end)
end

-- --- THÊM NỘI DUNG VÀO TAB 1: TRẠNG THÁI ---
local TabStatus = "Trạng thái"

-- 1. Tên nhân vật
CreateStatusItem(TabStatus, "Tên nhân vật :", function()
	return LocalPlayer.DisplayName .. " (@" .. LocalPlayer.Name .. ")"
end)

-- 2. Tộc (Race)
CreateStatusItem(TabStatus, "Tộc :", function()
	-- Thử lấy dữ liệu từ Data của Blox Fruit, nếu không có thì lấy Custom
	if LocalPlayer:FindFirstChild("Data") and LocalPlayer.Data:FindFirstChild("Race") then
		return LocalPlayer.Data.Race.Value
	end
	return "Human (Check Data)" -- Fallback nếu không tìm thấy
end)

-- 3. Beli (Tiền)
CreateStatusItem(TabStatus, "Beli :", function()
	if LocalPlayer:FindFirstChild("Data") and LocalPlayer.Data:FindFirstChild("Beli") then
		-- Format tiền tệ (ví dụ: 1,000,000)
		local money = LocalPlayer.Data.Beli.Value
		local formatted = tostring(money):reverse():gsub("%d%d%d", "%1,"):reverse():gsub("^,", "")
		return formatted .. " $"
	end
	return "0 $"
end)

-- 4. Điểm F (Fragments)
CreateStatusItem(TabStatus, "Điểm F :", function()
	if LocalPlayer:FindFirstChild("Data") and LocalPlayer.Data:FindFirstChild("Fragments") then
		local frag = LocalPlayer.Data.Fragments.Value
		local formatted = tostring(frag):reverse():gsub("%d%d%d", "%1,"):reverse():gsub("^,", "")
		return formatted
	end
	return "0"
end)

-- 5. Thời gian Server
CreateStatusItem(TabStatus, "Thời gian hoạt động :", function()
	local seconds = workspace.DistributedGameTime
	local hours = math.floor(seconds / 3600)
	local minutes = math.floor((seconds % 3600) / 60)
	local secs = math.floor(seconds % 60)
	return string.format("%02d:%02d:%02d", hours, minutes, secs)
end)

-- --- LOGIC KÉO THẢ ---
local dragging, dragInput, dragStart, startPos
local function update(input)
	local delta = input.Position - dragStart
	MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

MainFrame.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		dragging = true
		dragStart = input.Position
		startPos = MainFrame.Position
		input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then dragging = false end end)
	end
end)

MainFrame.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
		if dragging then update(input) end
	end
end)
