-- /////////////////////////////////////////////////////////////
-- /// BANANA CAT HUB - FIX ERROR VERSION (SAFE MODE) ///
-- /////////////////////////////////////////////////////////////

-- 1. KIỂM TRA MÔI TRƯỜNG
if not game:IsLoaded() then game.Loaded:Wait() end

-- 2. KHỞI TẠO DỊCH VỤ
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")
local CoreGui = game:GetService("CoreGui")

-- 3. CẤU HÌNH GIAO DIỆN
local Theme = {
    Background = Color3.fromRGB(30, 30, 30),
    YellowBorder = Color3.fromRGB(255, 235, 59),
    Text = Color3.fromRGB(255, 255, 255),
    Button = Color3.fromRGB(50, 50, 50),
    SelectedTab = Color3.fromRGB(80, 80, 80),
    Red = Color3.fromRGB(255, 85, 85),
    Orange = Color3.fromRGB(255, 170, 0),
    Green = Color3.fromRGB(85, 255, 127),
    BananaCatImage = "http://www.roblox.com/asset/?id=13693437997"
}

-- 4. XỬ LÝ PARENT (FIX LỖI KHÔNG HIỆN GUI)
-- Phần này quan trọng nhất: Tự động tìm nơi an toàn để hiện GUI
local GUI_NAME = "BananaCatHub_Fixed"
local Player = Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")
local ParentTarget = nil

-- Thử dùng CoreGui (Ưu tiên)
local success, result = pcall(function()
    return CoreGui
end)

if success then
    ParentTarget = result
else
    -- Nếu thất bại (trên Mobile Executor), dùng PlayerGui
    ParentTarget = PlayerGui
end

-- Xóa GUI cũ để không bị chồng lấp
if ParentTarget:FindFirstChild(GUI_NAME) then
    ParentTarget[GUI_NAME]:Destroy()
end
if PlayerGui:FindFirstChild(GUI_NAME) then -- Kiểm tra kỹ cả 2 nơi
    PlayerGui[GUI_NAME]:Destroy()
end

-- Tạo ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = GUI_NAME
ScreenGui.Parent = ParentTarget
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.ResetOnSpawn = false -- Chết không bị mất GUI
getgenv().BananaHub = ScreenGui -- Lưu vào biến toàn cục

print("GUI is loading on parent: " .. tostring(ParentTarget)) -- In ra để debug

-- /////////////////////////////////////////////////////////////
-- /// BẮT ĐẦU XÂY DỰNG GIAO DIỆN ///
-- /////////////////////////////////////////////////////////////

-- NÚT ICON TRÒN
local OpenButton = Instance.new("ImageButton")
OpenButton.Name = "OpenButton"
OpenButton.Parent = ScreenGui
OpenButton.BackgroundColor3 = Theme.Background 
OpenButton.Position = UDim2.new(0.1, 0, 0.1, 0)
OpenButton.Size = UDim2.new(0, 45, 0, 45) 
OpenButton.Image = Theme.BananaCatImage
OpenButton.Visible = true
OpenButton.BackgroundTransparency = 0.2
local OpenCorner = Instance.new("UICorner"); OpenCorner.CornerRadius = UDim.new(1, 0); OpenCorner.Parent = OpenButton
local OpenStroke = Instance.new("UIStroke"); OpenStroke.Color = Theme.YellowBorder; OpenStroke.Thickness = 2; OpenStroke.Parent = OpenButton

-- KHUNG CHÍNH
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Theme.Background
MainFrame.BackgroundTransparency = 0.6
MainFrame.Size = UDim2.new(0, 550, 0, 280)
MainFrame.Position = UDim2.new(0.5, -275, 0.5, -140)
MainFrame.ClipsDescendants = true
MainFrame.Visible = true 

local UICorner = Instance.new("UICorner"); UICorner.CornerRadius = UDim.new(0, 10); UICorner.Parent = MainFrame
local UIStroke = Instance.new("UIStroke"); UIStroke.Color = Theme.YellowBorder; UIStroke.Thickness = 3; UIStroke.Parent = MainFrame

-- HEADER
local Logo = Instance.new("ImageLabel"); Logo.Parent = MainFrame; Logo.BackgroundTransparency = 1; Logo.Position = UDim2.new(0, 5, 0, 3); Logo.Size = UDim2.new(0, 18, 0, 18); Logo.Image = Theme.BananaCatImage
local Title = Instance.new("TextLabel"); Title.Parent = MainFrame; Title.BackgroundTransparency = 1; Title.Position = UDim2.new(0, 28, 0, 3); Title.Size = UDim2.new(0, 200, 0, 18); Title.Font = Enum.Font.FredokaOne; Title.Text = "Banana Cat Hub"; Title.TextColor3 = Theme.YellowBorder; Title.TextSize = 14; Title.TextXAlignment = Enum.TextXAlignment.Left
local Separator = Instance.new("Frame"); Separator.Parent = MainFrame; Separator.BackgroundColor3 = Theme.YellowBorder; Separator.BorderSizePixel = 0; Separator.Position = UDim2.new(0, 0, 0, 25); Separator.Size = UDim2.new(1, 0, 0, 2)

-- NÚT ĐIỀU KHIỂN
local CloseButton = Instance.new("TextButton"); CloseButton.Parent = MainFrame; CloseButton.BackgroundColor3 = Theme.Red; CloseButton.Position = UDim2.new(1, -22, 0, 4); CloseButton.Size = UDim2.new(0, 18, 0, 18); CloseButton.Font = Enum.Font.FredokaOne; CloseButton.Text = "X"; CloseButton.TextColor3 = Color3.new(1,1,1); CloseButton.TextSize = 12; local CloseCorner = Instance.new("UICorner"); CloseCorner.CornerRadius = UDim.new(0, 4); CloseCorner.Parent = CloseButton
local MinimizeButton = Instance.new("TextButton"); MinimizeButton.Parent = MainFrame; MinimizeButton.BackgroundColor3 = Theme.Orange; MinimizeButton.Position = UDim2.new(1, -44, 0, 4); MinimizeButton.Size = UDim2.new(0, 18, 0, 18); MinimizeButton.Font = Enum.Font.FredokaOne; MinimizeButton.Text = "-"; MinimizeButton.TextColor3 = Color3.new(1,1,1); MinimizeButton.TextSize = 14; local MinCorner = Instance.new("UICorner"); MinCorner.CornerRadius = UDim.new(0, 4); MinCorner.Parent = MinimizeButton

-- LOGIC GUI
CloseButton.MouseButton1Click:Connect(function() ScreenGui:Destroy() end)
MinimizeButton.MouseButton1Click:Connect(function() MainFrame.Visible = false end)
OpenButton.MouseButton1Click:Connect(function()
    if MainFrame.Visible then MainFrame.Visible = false else MainFrame.Visible = true; MainFrame.Size = UDim2.new(0, 550, 0, 0); TweenService:Create(MainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Back), {Size = UDim2.new(0, 550, 0, 280)}):Play() end
end)

-- TAB SYSTEM
local Sidebar = Instance.new("ScrollingFrame"); Sidebar.Parent = MainFrame; Sidebar.Active = true; Sidebar.BackgroundColor3 = Theme.Background; Sidebar.BackgroundTransparency = 1; Sidebar.BorderSizePixel = 0; Sidebar.Position = UDim2.new(0, 5, 0, 30); Sidebar.Size = UDim2.new(0, 95, 0, 245); Sidebar.ScrollBarThickness = 2; Sidebar.ScrollBarImageColor3 = Theme.YellowBorder
local SidebarLayout = Instance.new("UIListLayout"); SidebarLayout.Parent = Sidebar; SidebarLayout.SortOrder = Enum.SortOrder.LayoutOrder; SidebarLayout.Padding = UDim.new(0, 5)

local VSeparator = Instance.new("Frame"); VSeparator.Parent = MainFrame; VSeparator.BackgroundColor3 = Theme.YellowBorder; VSeparator.BorderSizePixel = 0; VSeparator.Position = UDim2.new(0, 105, 0, 25); VSeparator.Size = UDim2.new(0, 2, 1, -25)
local PageContainer = Instance.new("Frame"); PageContainer.Parent = MainFrame; PageContainer.BackgroundTransparency = 1; PageContainer.Position = UDim2.new(0, 115, 0, 30); PageContainer.Size = UDim2.new(0, 425, 0, 240)

local FirstTab = nil
local function CreateTab(TabName)
    local TabButton = Instance.new("TextButton"); TabButton.Parent = Sidebar; TabButton.BackgroundColor3 = Theme.Button; TabButton.Size = UDim2.new(1, 0, 0, 25); TabButton.Font = Enum.Font.GothamBold; TabButton.Text = TabName; TabButton.TextColor3 = Theme.Text; TabButton.TextSize = 11; local TCorner = Instance.new("UICorner"); TCorner.CornerRadius = UDim.new(0, 4); TCorner.Parent = TabButton
    local Page = Instance.new("ScrollingFrame"); Page.Parent = PageContainer; Page.BackgroundTransparency = 1; Page.Size = UDim2.new(1, 0, 1, 0); Page.ScrollBarThickness = 2; Page.ScrollBarImageColor3 = Theme.YellowBorder; Page.Visible = false; local PageLayout = Instance.new("UIListLayout"); PageLayout.Parent = Page; PageLayout.SortOrder = Enum.SortOrder.LayoutOrder; PageLayout.Padding = UDim.new(0, 5)
    local PagePadding = Instance.new("UIPadding"); PagePadding.Parent = Page; PagePadding.PaddingTop = UDim.new(0, 5); PagePadding.PaddingLeft = UDim.new(0, 5)
    
    TabButton.MouseButton1Click:Connect(function()
        for _, item in pairs(PageContainer:GetChildren()) do if item:IsA("ScrollingFrame") then item.Visible = false end end
        for _, btn in pairs(Sidebar:GetChildren()) do if btn:IsA("TextButton") then btn.BackgroundColor3 = Theme.Button; btn.TextColor3 = Theme.Text end end
        Page.Visible = true; TabButton.BackgroundColor3 = Theme.YellowBorder; TabButton.TextColor3 = Color3.new(0,0,0)
    end)
    if FirstTab == nil then FirstTab = {Button = TabButton, Page = Page} end
    return Page
end

-- 14 TAB
local Tab1 = CreateTab("Trạng thái")
local Tab2 = CreateTab("Máy chủ")
local Tab3 = CreateTab("Chung")
local Tab4 = CreateTab("Biển")
local Tab5 = CreateTab("
