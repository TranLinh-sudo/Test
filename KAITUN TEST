--[[
    ============================================================
    PROJECT: TEST MODULE - FAST ATTACK & REACH
    DEVELOPER: GEMINI
    TARGET: MOBILE & PC
    ============================================================
]]

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- [CẤU HÌNH]
local SETTINGS = {
    HitboxSize = 60, -- Khoảng cách đánh (60 là rất xa, xa hơn Phật)
    AttackSpeed = true -- Bật đánh nhanh
}

-- GUI THÔNG BÁO
local StarterGui = game:GetService("StarterGui")
StarterGui:SetCore("SendNotification", {
    Title = "GEMINI TEST",
    Text = "Đã bật Fast Attack & Reach!",
    Duration = 5
})

-- [MODULE 1] FAST ATTACK (COMBAT FRAMEWORK)
local CombatFramework = require(LocalPlayer.PlayerScripts.CombatFramework)
local CameraShaker = require(LocalPlayer.PlayerScripts.CombatFramework.CameraShaker)

-- Tắt rung màn hình để đỡ chóng mặt
CameraShaker.CameraShakeInstance.CameraShakeState = {FadingIn = 3, FadingOut = 2, Sustained = 0, Inactive = 1}

local function DoAttack()
    pcall(function()
        local activeController = CombatFramework.activeController
        if activeController and activeController.equipped then
            activeController.attack()
        end
    end)
end

-- [MODULE 2] SUPER REACH (HITBOX EXPANDER)
local function DoReach()
    pcall(function()
        local Character = LocalPlayer.Character
        if Character then
            -- Tìm vũ khí đang cầm
            local Tool = Character:FindFirstChildOfClass("Tool")
            if Tool and Tool:FindFirstChild("Handle") then
                -- Phóng to Hitbox
                Tool.Handle.Size = Vector3.new(SETTINGS.HitboxSize, SETTINGS.HitboxSize, SETTINGS.HitboxSize)
                Tool.Handle.Massless = true -- Làm nhẹ để không bị nặng tay
                Tool.Handle.CanCollide = false -- Tắt va chạm để không bị kẹt
                
                -- Tạo khung đỏ để bạn nhìn thấy phạm vi (Visual)
                if not Tool.Handle:FindFirstChild("ReachBox") then
                    local box = Instance.new("SelectionBox")
                    box.Name = "ReachBox"
                    box.Adornee = Tool.Handle
                    box.Parent = Tool.Handle
                    box.Color3 = Color3.fromRGB(255, 0, 0) -- Màu đỏ
                    box.Transparency = 0.5
                end
            end
        end
    end)
end

-- [MAIN LOOP] CHẠY LIÊN TỤC
RunService.RenderStepped:Connect(function()
    -- 1. Kích hoạt Reach (Phải làm liên tục vì game sẽ tự reset size)
    DoReach()
    
    -- 2. Kích hoạt đánh
    if SETTINGS.AttackSpeed then
        DoAttack()
    end
end)
