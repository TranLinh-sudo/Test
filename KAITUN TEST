--[[
    ============================================================
    PROJECT: KAITUN PLATINUM (PREMIUM MOBILE)
    DEVELOPER: GEMINI
    METHOD: GIANT HITBOX + RAW FAST ATTACK
    ============================================================
]]

-- [1] SETTINGS (CẤU HÌNH)
local Settings = {
    FlySpeed = 350,
    AutoStats = true,
    AutoHaki = true,
    HitboxSize = 60, -- Kích thước quái (60 là rất to, không thể đánh trượt)
    FastAttackSpeed = 0 -- 0 là nhanh nhất
}

-- [2] GUI STATUS (BẢNG TRẠNG THÁI)
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local CoreGui = game:GetService("CoreGui")

local ScreenGui = Instance.new("ScreenGui")
local Frame = Instance.new("Frame")
local StatusLabel = Instance.new("TextLabel")

ScreenGui.Name = "KaitunPlatinum"
if gethui then ScreenGui.Parent = gethui() else ScreenGui.Parent = CoreGui end

Frame.Parent = ScreenGui
Frame.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
Frame.BorderSizePixel = 0
Frame.Position = UDim2.new(0.25, 0, 0.05, 0)
Frame.Size = UDim2.new(0.5, 0, 0.08, 0)

StatusLabel.Parent = Frame
StatusLabel.Size = UDim2.new(1,0,1,0)
StatusLabel.BackgroundTransparency = 1
StatusLabel.TextColor3 = Color3.fromRGB(0, 255, 255) -- Cyan
StatusLabel.Font = Enum.Font.GothamBold
StatusLabel.TextSize = 14
StatusLabel.Text = "⚡ PLATINUM LOADING... ⚡"

local function SetStatus(txt)
    StatusLabel.Text = txt
end

-- [3] SERVICES & SETUP
if not game:IsLoaded() then game.Loaded:Wait() end
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local VirtualUser = game:GetService("VirtualUser")

-- Anti AFK
LocalPlayer.Idled:Connect(function()
    VirtualUser:Button2Down(Vector2.new(0,0))
    VirtualUser:Button2Up(Vector2.new(0,0))
end)

-- [4] *** CÔNG NGHỆ PREMIUM: GIANT HITBOX ***
-- Biến quái vật thành khổng lồ để đánh là trúng
task.spawn(function()
    while task.wait(0.5) do
        pcall(function()
            for _, v in pairs(Workspace.Enemies:GetChildren()) do
                if v:FindFirstChild("HumanoidRootPart") and v:FindFirstChild("Humanoid") and v.Humanoid.Health > 0 then
                    local Root = v.HumanoidRootPart
                    Root.Size = Vector3.new(Settings.HitboxSize, Settings.HitboxSize, Settings.HitboxSize)
                    Root.Transparency = 0.7 -- Làm mờ để nhìn xuyên qua
                    Root.CanCollide = false -- Tắt va chạm để đứng lồng vào quái
                    Root.Color = Color3.fromRGB(255, 0, 0) -- Màu đỏ
                    v.Humanoid.WalkSpeed = 0 -- Trói chân quái
                    if v:FindFirstChild("Head") then v.Head.CanCollide = false end
                end
            end
        end)
    end
end)

-- [5] *** CÔNG NGHỆ PREMIUM: RAW FAST ATTACK ***
-- Spam lệnh đánh trực tiếp, không qua module trung gian
task.spawn(function()
    while true do
        pcall(function()
            -- 1. Equip Tool
            local Tool = LocalPlayer.Character:FindFirstChildOfClass("Tool")
            if not Tool then
                local BgTool = LocalPlayer.Backpack:FindFirstChildOfClass("Tool")
                if BgTool and (BgTool.ToolTip == "Melee" or BgTool.ToolTip == "Sword") then
                    LocalPlayer.Character.Humanoid:EquipTool(BgTool)
                end
            else
                -- 2. Attack
                Tool:Activate()
            end
        end)
        task.wait(Settings.FastAttackSpeed) -- Spam tốc độ cao
    end
end)

-- [6] CORE FUNCTIONS
local function FlyTo(targetCFrame)
    if not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then return end
    local Root = LocalPlayer.Character.HumanoidRootPart
    
    local Dist = (Root.Position - targetCFrame.Position).Magnitude
    if Dist < 5 then 
        Root.CFrame = targetCFrame 
        return 
    end
    
    local Tween = TweenService:Create(Root, TweenInfo.new(Dist / Settings.FlySpeed, Enum.EasingStyle.Linear), {CFrame = targetCFrame})
    
    -- BodyVelocity để giữ nhân vật bay
    local BV = Instance.new("BodyVelocity", Root)
    BV.Velocity = Vector3.new(0,0,0)
    BV.MaxForce = Vector3.new(1e9, 1e9, 1e9)
    
    Tween:Play()
    Tween.Completed:Wait()
    BV:Destroy()
end

-- Auto Stats
task.spawn(function()
    while task.wait(2) do
        if Settings.AutoStats then
            local Pts = LocalPlayer.Data.Points.Value
            if Pts > 0 then
                local Melee = math.floor(Pts * 0.7)
                local Def = Pts - Melee
                ReplicatedStorage.Remotes.CommF_:InvokeServer("AddPoint", "Melee", Melee)
                ReplicatedStorage.Remotes.CommF_:InvokeServer("AddPoint", "Defense", Def)
            end
        end
        -- Auto Haki
        if Settings.AutoHaki and not LocalPlayer.Character:FindFirstChild("HasBuso") then
             ReplicatedStorage.Remotes.CommF_:InvokeServer("Buso")
        end
    end
end)

-- [7] QUEST DATA (FULL 1-700)
local QUESTS = {
    {Min=1, Max=10, Npc="Bandit Quest Giver", Quest="BanditQuest1", Idx=1, Mob="Bandit"},
    {Min=10, Max=15, Npc="Jungle Quest Giver", Quest="JungleQuest", Idx=1, Mob="Monkey"},
    {Min=15, Max=30, Npc="Jungle Quest Giver", Quest="JungleQuest", Idx=2, Mob="Gorilla"},
    {Min=30, Max=40, Npc="Buggy Quest Giver", Quest="BuggyQuest1", Idx=1, Mob="Pirate"},
    {Min=40, Max=60, Npc="Buggy Quest Giver", Quest="BuggyQuest1", Idx=2, Mob="Brute"},
    {Min=60, Max=75, Npc="Desert Quest Giver", Quest="DesertQuest", Idx=1, Mob="Desert Bandit"},
    {Min=75, Max=90, Npc="Desert Quest Giver", Quest="DesertQuest", Idx=2, Mob="Desert Officer"},
    {Min=90, Max=105, Npc="Snow Village Quest Giver", Quest="SnowQuest", Idx=1, Mob="Snow Bandit"},
    {Min=105, Max=120, Npc="Snow Village Quest Giver", Quest="SnowQuest", Idx=2, Mob="Snowman"},
    {Min=120, Max=150, Npc="Marine Quest Giver", Quest="MarineQuest2", Idx=1, Mob="Chief Petty Officer"},
    {Min=150, Max=175, Npc="Sky Quest Giver", Quest="SkyQuest", Idx=1, Mob="Sky Bandit"},
    {Min=175, Max=190, Npc="Sky Quest Giver", Quest="SkyQuest", Idx=2, Mob="Dark Master"},
    {Min=190, Max=210, Npc="Prisoner Quest Giver", Quest="PrisonerQuest", Idx=1, Mob="Prisoner"},
    {Min=210, Max=230, Npc="Prisoner Quest Giver", Quest="PrisonerQuest", Idx=2, Mob="Dangerous Prisoner"},
    {Min=230, Max=250, Npc="Colosseum Quest Giver", Quest="ColosseumQuest", Idx=1, Mob="Toga Warrior"},
    {Min=250, Max=300, Npc="Colosseum Quest Giver", Quest="ColosseumQuest", Idx=2, Mob="Gladiator"},
    {Min=300, Max=330, Npc="Magma Quest Giver", Quest="MagmaQuest", Idx=1, Mob="Military Soldier"},
    {Min=330, Max=375, Npc="Magma Quest Giver", Quest="MagmaQuest", Idx=2, Mob="Military Spy"},
    {Min=375, Max=400, Npc="Fishman Quest Giver", Quest="FishmanQuest", Idx=1, Mob="Fishman Warrior"},
    {Min=400, Max=450, Npc="Fishman Quest Giver", Quest="FishmanQuest", Idx=2, Mob="Fishman Commando"},
    {Min=450, Max=475, Npc="Upper Yard Quest Giver", Quest="SkyExp1Quest", Idx=1, Mob="God's Guard"},
    {Min=475, Max=525, Npc="Upper Yard Quest Giver", Quest="SkyExp1Quest", Idx=2, Mob="Shanda"},
    {Min=525, Max=550, Npc="Upper Yard Quest Giver 2", Quest="SkyExp2Quest", Idx=1, Mob="Royal Squad"},
    {Min=550, Max=625, Npc="Upper Yard Quest Giver 2", Quest="SkyExp2Quest", Idx=2, Mob="Royal Soldier"},
    {Min=625, Max=650, Npc="Galley Captain", Quest="FountainQuest", Idx=1, Mob="Galley Pirate"},
    {Min=650, Max=700, Npc="Galley Captain", Quest="FountainQuest", Idx=2, Mob="Galley Captain"},
}

-- [8] MAIN LOOP
RunService.Stepped:Connect(function()
    -- Noclip liên tục để chui vào trong hitbox quái
    if LocalPlayer.Character then
        for _, v in pairs(LocalPlayer.Character:GetDescendants()) do
            if v:IsA("BasePart") then v.CanCollide = false end
        end
        if LocalPlayer.Character:FindFirstChild("Humanoid") then
            LocalPlayer.Character.Humanoid:ChangeState(11)
        end
    end
end)

task.spawn(function()
    while task.wait() do
        pcall(function()
            local Level = LocalPlayer.Data.Level.Value
            
            -- Tìm Quest
            local Data = nil
            for _, d in ipairs(QUESTS) do
                if Level >= d.Min and Level < d.Max then Data = d; break end
            end
            
            if not Data then SetStatus("Max Level!"); return end
            
            -- Check Quest
            local HasQuest = LocalPlayer.PlayerGui.Main:FindFirstChild("Quest") and LocalPlayer.PlayerGui.Main.Quest.Visible
            
            if not HasQuest then
                SetStatus("Nhận NV: " .. Data.Mob)
                local NPC = Workspace.NPCs:FindFirstChild(Data.Npc)
                if NPC then
                    FlyTo(NPC.Head.CFrame)
                    ReplicatedStorage.Remotes.CommF_:InvokeServer("StartQuest", Data.Quest, Data.Idx)
                    task.wait(0.5)
                else
                    SetStatus("Load Map...")
                    local Spawns = Workspace._WorldOrigin.EnemySpawns:FindFirstChild(Data.Mob)
                    if Spawns then FlyTo(Spawns.CFrame * CFrame.new(0, 50, 0)) end
                end
            else
                SetStatus("Đang Farm: " .. Data.Mob)
                
                -- Tìm quái
                local Target = nil
                for _, v in pairs(Workspace.Enemies:GetChildren()) do
                    if v.Name == Data.Mob and v:FindFirstChild("Humanoid") and v.Humanoid.Health > 0 then
                        Target = v
                        break
                    end
                end
                
                if Target then
                    -- Bay vào GIỮA bụng con quái (Vì hitbox đã phóng to)
                    FlyTo(Target.HumanoidRootPart.CFrame) 
                else
                    SetStatus("Đợi Spawn...")
                    local Spawns = Workspace._WorldOrigin.EnemySpawns:FindFirstChild(Data.Mob)
                    if Spawns then FlyTo(Spawns.CFrame * CFrame.new(0, 30, 0)) end
                end
            end
        end)
    end
end)
